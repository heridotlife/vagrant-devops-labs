#############################################################################
# Kubernetes Lab - Environment Configuration (MVP)
#############################################################################
# This file contains all configurable parameters for the Kubernetes lab.
# Copy this file to .env and customize as needed:
#   cp .env.example .env
#
# After making changes, reload with:
#   make reload
#############################################################################

#############################################################################
# CLUSTER CONFIGURATION
#############################################################################

# Cluster name (used for kubeconfig context)
CLUSTER_NAME=k8s-lab

# Kubernetes version (supported: 1.31.x)
# MVP: Only 1.31.x is supported initially
K8S_VERSION=1.31.0

# Component versions (auto-detected if not set)
ETCD_VERSION=3.5.11
CONTAINERD_VERSION=1.7.13
RUNC_VERSION=1.1.10
CNI_PLUGINS_VERSION=1.4.0

#############################################################################
# VIRTUAL MACHINE CONFIGURATION
#############################################################################

# Operating System
# MVP: Only centos-stream-9 supported
VM_OS=centos-stream-9

# Number of nodes
# MVP: 1 master + 2 workers (fixed for simplicity)
VM_COUNT_MASTERS=1
VM_COUNT_WORKERS=2

# VM Resources - Master Nodes
VM_MASTER_CPUS=2
VM_MASTER_MEMORY=2048     # MB
VM_MASTER_DISK=40GB

# VM Resources - Worker Nodes
VM_WORKER_CPUS=2
VM_WORKER_MEMORY=2048     # MB
VM_WORKER_DISK=40GB

# VM Box
# CentOS Stream 9 box from Vagrant Cloud
VM_BOX=generic/centos9s
VM_BOX_VERSION=4.3.12

#############################################################################
# NETWORK CONFIGURATION
#############################################################################

# Host-only network (where VMs will be accessible from host)
# Do NOT change this unless you have conflicts with existing networks
NETWORK_CIDR=10.240.0.0/24

# Node IP addresses (within NETWORK_CIDR)
MASTER_IP_START=10.240.0.11    # master-01: 10.240.0.11
WORKER_IP_START=10.240.0.21    # worker-01: 10.240.0.21, worker-02: 10.240.0.22

# Kubernetes network CIDRs
POD_CIDR=10.244.0.0/16          # Pod network
SERVICE_CIDR=10.96.0.0/16       # Service network
CLUSTER_DNS=10.96.0.10          # CoreDNS service IP

# MetalLB IP pool (must be within NETWORK_CIDR and not overlap with node IPs)
METALLB_IP_START=10.240.0.200
METALLB_IP_END=10.240.0.220

#############################################################################
# CONTAINER RUNTIME
#############################################################################

# Container runtime
# MVP: Only containerd supported
CONTAINER_RUNTIME=containerd

# Container runtime socket
CONTAINER_RUNTIME_ENDPOINT=unix:///var/run/containerd/containerd.sock

# Cgroup driver (must match kubelet)
CGROUP_DRIVER=systemd

#############################################################################
# CNI CONFIGURATION
#############################################################################

# CNI Plugin
# MVP: Only calico supported
CNI_PLUGIN=calico

# Calico version
CALICO_VERSION=v3.27.0

# Calico backend (options: vxlan, ipip, bird)
# vxlan recommended for simplicity
CALICO_BACKEND=vxlan

#############################################################################
# STORAGE CONFIGURATION
#############################################################################

# Storage provisioner
# MVP: local-path-provisioner (simple, no extra disk needed)
# Future: rook-ceph (requires additional disk)
STORAGE_PROVISIONER=local-path

# Default storage class name
DEFAULT_STORAGE_CLASS=local-path

# Local path provisioner settings
LOCAL_PATH_PROVISIONER_VERSION=v0.0.26
LOCAL_PATH_PROVISIONER_PATH=/opt/local-path-provisioner

#############################################################################
# PKI AND SECURITY
#############################################################################

# Certificate validity in days (10 years)
CERT_VALIDITY_DAYS=3650

# Encryption at rest for secrets
ENABLE_ENCRYPTION_AT_REST=true

# Audit logging
ENABLE_AUDIT_LOGGING=false

# Audit log path
AUDIT_LOG_PATH=/var/log/kubernetes/audit.log

#############################################################################
# LOADBALANCER CONFIGURATION
#############################################################################

# MetalLB version
METALLB_VERSION=v0.14.3

# MetalLB mode (layer2 or bgp)
# MVP: layer2 (simpler, no BGP configuration needed)
METALLB_MODE=layer2

#############################################################################
# DNS CONFIGURATION
#############################################################################

# CoreDNS version
COREDNS_VERSION=1.11.1

# Cluster domain
CLUSTER_DOMAIN=cluster.local

# Enable host DNS resolution (.k8s.local from Mac)
ENABLE_HOST_DNS=true

# Update /etc/hosts on host machine with node names
UPDATE_HOST_HOSTS=true

#############################################################################
# DEVELOPER EXPERIENCE
#############################################################################

# Automatically merge kubeconfig to ~/.kube/config
AUTO_MERGE_KUBECONFIG=true

# Kubeconfig context name
KUBECONFIG_CONTEXT=${CLUSTER_NAME}

# Install development tools on nodes
# Includes: kubectl, crictl, etcdctl
INSTALL_DEV_TOOLS=true

# Enable kubectl auto-completion
KUBECTL_COMPLETION=true

#############################################################################
# LOGGING AND DEBUGGING
#############################################################################

# Log level (DEBUG, INFO, WARN, ERROR)
LOG_LEVEL=INFO

# Ansible verbosity (0-4)
# 0: normal, 1: -v, 2: -vv, 3: -vvv, 4: -vvvv
ANSIBLE_VERBOSITY=0

# Keep logs after provisioning
KEEP_LOGS=true

# Log directory
LOG_DIR=./logs

#############################################################################
# VAGRANT CONFIGURATION
#############################################################################

# Vagrant provider
VAGRANT_PROVIDER=virtualbox

# Enable Vagrant host manager (auto-update /etc/hosts)
VAGRANT_HOSTMANAGER=true

# Sync type (rsync, nfs, virtualbox)
SYNC_TYPE=rsync

# Forward API server port to host
# Set to 0 to disable
API_SERVER_HOST_PORT=6443

#############################################################################
# ADVANCED CONFIGURATION
#############################################################################

# Enable IPv6 (experimental)
ENABLE_IPV6=false

# Service node port range
SERVICE_NODE_PORT_RANGE=30000-32767

# Maximum pods per node
MAX_PODS_PER_NODE=110

# Pod eviction timeout
POD_EVICTION_TIMEOUT=5m0s

# Node status update frequency
NODE_STATUS_UPDATE_FREQUENCY=10s

#############################################################################
# FEATURE FLAGS
#############################################################################

# Enable features (true/false)
ENABLE_METRICS_SERVER=false      # Metrics server for HPA (future)
ENABLE_INGRESS=false              # Ingress controller (future)
ENABLE_DASHBOARD=false            # Kubernetes dashboard (future)
ENABLE_MONITORING=false           # Prometheus/Grafana (future)
ENABLE_HELM=true                  # Install Helm on master node

#############################################################################
# EXPERIMENTAL FEATURES (Not for MVP)
#############################################################################

# These are placeholders for future enhancements
ENABLE_HA_CONTROL_PLANE=false    # 3-master HA setup
ENABLE_FEDORA_COREOS=false       # Fedora CoreOS support
ENABLE_MULTI_VERSION=false       # Multiple K8s versions
ENABLE_BINARY_CACHE=false        # Local binary caching
