# Ansible Configuration

This directory contains all Ansible playbooks, roles, and inventory for provisioning the Kubernetes cluster.

## Structure

```
ansible/
├── ansible.cfg              # Ansible configuration file
├── inventory/               # Inventory files
│   ├── hosts.ini           # Static inventory (generated by Vagrant)
│   └── group_vars/         # Group variables
│       ├── all.yml         # Variables for all hosts
│       ├── masters.yml     # Master node variables
│       └── workers.yml     # Worker node variables
├── playbooks/               # Ansible playbooks
│   ├── site.yml            # Main playbook (orchestrates everything)
│   ├── prerequisites.yml   # System prerequisites
│   ├── pki.yml             # PKI and certificates
│   ├── container-runtime.yml  # Container runtime setup
│   ├── etcd.yml            # etcd cluster setup
│   ├── control-plane.yml   # Control plane components
│   ├── workers.yml         # Worker node setup
│   ├── network.yml         # CNI deployment
│   ├── dns.yml             # CoreDNS deployment
│   ├── loadbalancer.yml    # MetalLB deployment
│   ├── storage.yml         # Storage provisioner
│   └── cleanup.yml         # Cluster cleanup
└── roles/                   # Ansible roles
    ├── common/              # Base system configuration
    ├── container-runtime/   # containerd setup
    ├── pki/                 # Certificate generation and distribution
    ├── etcd/                # etcd cluster
    ├── kube-apiserver/      # API server
    ├── kube-controller-manager/  # Controller manager
    ├── kube-scheduler/      # Scheduler
    ├── kubelet/             # Kubelet service
    ├── kube-proxy/          # kube-proxy
    ├── cni-calico/          # Calico CNI
    ├── coredns/             # CoreDNS
    ├── metallb/             # MetalLB LoadBalancer
    └── local-path-provisioner/  # Local storage provisioner
```

## Usage

Playbooks are typically run by Vagrant during provisioning, but can also be run manually:

```bash
# Run the main playbook
ansible-playbook -i inventory/hosts.ini playbooks/site.yml

# Run specific playbook
ansible-playbook -i inventory/hosts.ini playbooks/control-plane.yml

# Run with tags
ansible-playbook -i inventory/hosts.ini playbooks/site.yml --tags pki,etcd
```

## Roles

Each role follows the standard Ansible role structure:
- `tasks/` - Main tasks for the role
- `templates/` - Jinja2 templates
- `files/` - Static files to copy
- `handlers/` - Handlers (triggered by notify)
- `defaults/` - Default variables (lowest precedence)
- `vars/` - Variables (higher precedence)
- `meta/` - Role metadata and dependencies
