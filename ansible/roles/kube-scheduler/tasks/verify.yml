---
#############################################################################
# kube-scheduler - Verification Tasks
#############################################################################

- name: Check if kube-scheduler is listening
  wait_for:
    host: 127.0.0.1
    port: "{{ scheduler_secure_port }}"
    timeout: 30

- name: Verify kube-scheduler process
  command: pgrep -f kube-scheduler
  register: scheduler_process
  changed_when: false
  failed_when: scheduler_process.rc != 0

- name: Check scheduler health endpoint
  uri:
    url: "https://127.0.0.1:{{ scheduler_secure_port }}/healthz"
    validate_certs: no
    return_content: yes
  register: healthz_check
  failed_when: healthz_check.status != 200
  retries: 5
  delay: 5

- name: Display verification summary
  debug:
    msg:
      - "════════════════════════════════════════"
      - "  kube-scheduler Verification Complete"
      - "════════════════════════════════════════"
      - "Status: Running"
      - "Port: {{ scheduler_secure_port }}"
      - "Health: {{ healthz_check.content }}"
      - "Process ID: {{ scheduler_process.stdout }}"
